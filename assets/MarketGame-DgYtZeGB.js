import{c as G,r as n,j as t}from"./index-ygY7VRFv.js";import{L as M,m as x,A as Q}from"./Layout-CtCKEkqP.js";import{G as R,c as A}from"./GameShell-BOq1h0bL.js";import{u as H}from"./use-tts-C-8um_0W.js";import{S as O}from"./shopping-cart-DlGM08tu.js";import"./use-scores-BYx9YBm8.js";import"./dialog-5Sutmzol.js";import"./input-DLOEtVGp.js";const E=G("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),F=[{id:"apple",name:"è˜‹æœ",emoji:"ğŸ",price:10},{id:"milk",name:"ç‰›å¥¶",emoji:"ğŸ¥›",price:20},{id:"bread",name:"éºµåŒ…",emoji:"ğŸ",price:15},{id:"banana",name:"é¦™è•‰",emoji:"ğŸŒ",price:5},{id:"egg",name:"é›è›‹",emoji:"ğŸ¥š",price:8},{id:"cheese",name:"èµ·å¸",emoji:"ğŸ§€",price:25},{id:"carrot",name:"èƒ¡è˜¿è””",emoji:"ğŸ¥•",price:6},{id:"cookie",name:"é¤…ä¹¾",emoji:"ğŸª",price:12}],D=[{value:10,emoji:"ğŸ”´",color:"bg-red-400"},{value:5,emoji:"ğŸŸ¡",color:"bg-yellow-400"},{value:1,emoji:"ğŸŸ¤",color:"bg-amber-600"}];function Y(){const[u,b]=n.useState(0),[N,y]=n.useState(0),[i,C]=n.useState([]),[r,h]=n.useState([]),[d,g]=n.useState(0),[S,j]=n.useState("shopping"),[m,p]=n.useState(null),[k,w]=n.useState(!1),{speak:o}=H(),c=i.reduce((e,s)=>e+s.product.price*s.quantity,0),$=()=>{const e=[...F].sort(()=>.5-Math.random()),s=Math.min(2+Math.floor(u/3),3);return e.slice(0,s).map(f=>({product:f,quantity:1}))};n.useEffect(()=>{if(u>=10){w(!0);return}const e=$();C(e),h([]),g(0),j("shopping"),p(null);const s=e.map(a=>`${a.quantity}å€‹${a.product.name}`).join("å’Œ");o(`è«‹å¹«åª½åª½è²·${s}ï¼`)},[u]);const q=e=>{const s=i.find(l=>l.product.id===e.id);if(!s)return;const a=r.find(l=>l.product.id===e.id);(a?.quantity||0)<s.quantity&&(h(a?r.map(l=>l.product.id===e.id?{...l,quantity:l.quantity+1}:l):[...r,{product:e,quantity:1}]),o(e.name))},v=()=>i.every(e=>{const s=r.find(a=>a.product.id===e.product.id);return s&&s.quantity>=e.quantity}),T=()=>{v()?(j("payment"),o(`ç¸½å…±${c}å…ƒï¼Œè«‹ç”¨ç¡¬å¹£ä»˜æ¬¾ï¼`)):o("è³¼ç‰©ç±ƒé‚„æ²’è£æ»¿å–”ï¼")},I=e=>{g(s=>s+e.value)},P=()=>{d===c?(A({particleCount:100,spread:70,origin:{y:.6}}),o("ä»˜æ¬¾æˆåŠŸï¼è¬è¬å…‰è‡¨ï¼"),p("success"),y(e=>e+10),setTimeout(()=>{b(e=>e+1)},1500)):d>c?(o("éŒ¢å¤ªå¤šäº†ï¼Œé‡æ–°ä»˜æ¬¾ï¼"),p("fail"),setTimeout(()=>{g(0),p(null)},1e3)):o("éŒ¢é‚„ä¸å¤ å–”ï¼")},L=()=>{b(0),y(0),w(!1),h([]),g(0),j("shopping"),p(null)};return t.jsx(M,{children:t.jsx(R,{title:"è¶…å¸‚å°å¹«æ‰‹",score:N,totalQuestions:10,currentQuestionIndex:u,gameType:"market",isGameOver:k,onRestart:L,colorClass:"bg-[hsl(var(--macaron-blue))] text-[hsl(var(--macaron-blue-dark))]",children:t.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4 md:gap-6",children:[t.jsxs("div",{className:"bg-white/60 px-3 sm:px-4 py-2 sm:py-3 rounded-xl sm:rounded-2xl shadow-md",children:[t.jsx("h4",{className:"font-bold text-sm sm:text-base mb-2 text-center",children:"è³¼ç‰©æ¸…å–®"}),t.jsxs("div",{className:"flex gap-2 sm:gap-3 flex-wrap justify-center",children:[i.map(e=>{const a=(r.find(f=>f.product.id===e.product.id)?.quantity||0)>=e.quantity;return t.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-lg ${a?"bg-green-100":"bg-gray-100"}`,children:[t.jsx("span",{className:"text-lg sm:text-xl",children:e.product.emoji}),t.jsxs("span",{className:"text-xs sm:text-sm",children:[e.quantity,"å€‹"]}),t.jsxs("span",{className:"text-xs text-gray-500",children:["$",e.product.price]}),a&&t.jsx(E,{className:"w-3 h-3 text-green-500"})]},e.product.id)}),t.jsxs("div",{className:"w-full text-center text-xs sm:text-sm font-bold text-gray-600 mt-1",children:["ç¸½è¨ˆï¼š$",c]})]})]}),S==="shopping"?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"bg-amber-100 p-3 sm:p-4 rounded-xl sm:rounded-2xl border-2 border-amber-200",children:t.jsx("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:i.map(e=>t.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>q(e.product),className:"bg-white p-2 sm:p-3 rounded-xl shadow-md flex flex-col items-center gap-1","data-testid":`product-${e.product.id}`,children:[t.jsx("span",{className:"text-2xl sm:text-3xl",children:e.product.emoji}),t.jsx("span",{className:"text-xs font-medium",children:e.product.name}),t.jsxs("span",{className:"text-xs text-gray-500",children:["$",e.product.price]})]},e.product.id))})}),t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 bg-white/50 px-4 py-2 rounded-full",children:[t.jsx(O,{className:"w-5 h-5 sm:w-6 sm:h-6"}),t.jsxs("div",{className:"flex gap-1",children:[r.map((e,s)=>t.jsx("span",{className:"text-lg sm:text-xl",children:e.product.emoji},s)),r.length===0&&t.jsx("span",{className:"text-gray-400 text-sm",children:"è³¼ç‰©ç±ƒæ˜¯ç©ºçš„"})]})]}),t.jsx(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:T,disabled:!v(),className:"bg-[hsl(var(--macaron-green))] text-white px-6 py-3 rounded-full font-bold text-sm sm:text-base shadow-lg disabled:opacity-50","data-testid":"button-checkout",children:"å»çµå¸³"})]}):t.jsx(t.Fragment,{children:t.jsxs("div",{className:"bg-white/60 p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-md text-center",children:[t.jsxs("h4",{className:"font-bold text-base sm:text-lg mb-3",children:["è«‹ä»˜ $",c]}),t.jsxs("div",{className:"text-3xl sm:text-4xl font-bold mb-4",children:["å·²ä»˜ï¼š",t.jsxs("span",{className:d===c?"text-green-500":d>c?"text-red-500":"",children:["$",d]})]}),t.jsx("div",{className:"flex gap-2 sm:gap-3 justify-center mb-4",children:D.map(e=>t.jsxs(x.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>I(e),disabled:m!==null,className:`
                        ${e.color} w-12 h-12 sm:w-14 sm:h-14 rounded-full 
                        flex items-center justify-center font-bold text-white text-sm sm:text-base
                        shadow-lg border-4 border-white
                      `,"data-testid":`coin-${e.value}`,children:["$",e.value]},e.value))}),t.jsx(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:P,disabled:m!==null,className:"bg-[hsl(var(--macaron-yellow))] text-[hsl(var(--macaron-yellow-dark))] px-6 py-3 rounded-full font-bold shadow-lg","data-testid":"button-pay",children:"ç¢ºèªä»˜æ¬¾"})]})}),t.jsx(Q,{children:m&&t.jsx(x.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:`
                  px-6 py-3 rounded-full font-bold text-lg
                  ${m==="success"?"bg-green-400 text-white":"bg-red-400 text-white"}
                `,children:m==="success"?"ä»˜æ¬¾æˆåŠŸï¼ğŸ‰":"é‡‘é¡ä¸å°å–”ï¼ğŸ’°"})})]})})})}export{Y as default};
