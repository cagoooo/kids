import{c as R,r as l,j as e,R as A}from"./index-dxj7E4H-.js";import{L as E,m,A as N}from"./Layout-CmlOHSNV.js";import{G}from"./GameShell-CODfseyM.js";import{e as H}from"./confetti.module-BS7HiWFO.js";import{u as q}from"./use-tts-BqW3F_mk.js";import{P as D}from"./play-BPPHyrhe.js";import"./use-scores-D77kwo0O.js";import"./input-R0n0rv70.js";const F=R("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);const T=R("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),k=[{grid:[[0,0,0,0],[0,1,1,0],[0,1,2,0],[0,0,0,0]],start:{x:1,y:1,direction:"right"},goal:{x:2,y:2},maxCommands:3},{grid:[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,2,0]],start:{x:1,y:1,direction:"down"},goal:{x:2,y:3},maxCommands:4},{grid:[[0,0,0,0,0],[0,1,1,1,0],[0,0,0,1,0],[0,0,0,2,0],[0,0,0,0,0]],start:{x:1,y:1,direction:"right"},goal:{x:3,y:3},maxCommands:5},{grid:[[0,0,0,0,0],[0,1,0,1,0],[0,1,1,1,0],[0,0,0,2,0],[0,0,0,0,0]],start:{x:1,y:1,direction:"down"},goal:{x:3,y:3},maxCommands:6},{grid:[[0,0,0,0,0],[0,1,1,1,0],[0,1,0,1,0],[0,1,1,2,0],[0,0,0,0,0]],start:{x:1,y:1,direction:"down"},goal:{x:3,y:3},maxCommands:7}],j={forward:{name:"å‰é€²",icon:F,color:"bg-[hsl(var(--macaron-green))]"},left:{name:"å·¦è½‰",icon:T,color:"bg-[hsl(var(--macaron-blue))]"},right:{name:"å³è½‰",icon:A,color:"bg-[hsl(var(--macaron-pink))]"}};function S(n,f){const x=["up","right","down","left"],h=x.indexOf(n);return f==="left"?x[(h+3)%4]:x[(h+1)%4]}function Q(n){switch(n.direction){case"up":return{x:n.x,y:n.y-1};case"down":return{x:n.x,y:n.y+1};case"left":return{x:n.x-1,y:n.y};case"right":return{x:n.x+1,y:n.y}}}function U(n){switch(n){case"up":return 0;case"right":return 90;case"down":return 180;case"left":return 270}}function Y(){const[n,f]=l.useState(0),[x,h]=l.useState(0),[i,d]=l.useState([]),[c,v]=l.useState(!1),[p,w]=l.useState(null),[b,g]=l.useState(null),[I,C]=l.useState(!1),{speak:u}=q(),r=k[Math.min(n,k.length-1)];l.useEffect(()=>{if(n>=5){C(!0);return}w(r.start),d([]),g(null),u("æ’åˆ—æŒ‡ä»¤ï¼Œå¹«åŠ©å°ç†Šæ‰¾åˆ°èœ‚èœœï¼")},[n]);const L=t=>{i.length<r.maxCommands&&!c&&d([...i,t])},P=t=>{c||d(i.filter((s,a)=>a!==t))},$=()=>{c||d([])},M=l.useCallback(async()=>{if(i.length===0){u("è«‹å…ˆæ’åˆ—æŒ‡ä»¤ï¼");return}v(!0);let t={...r.start};for(const s of i){if(await new Promise(a=>setTimeout(a,600)),s==="forward"){const a=Q(t);a.x>=0&&a.x<r.grid[0].length&&a.y>=0&&a.y<r.grid.length&&r.grid[a.y][a.x]!==0&&(t={...t,x:a.x,y:a.y})}else s==="left"?t={...t,direction:S(t.direction,"left")}:s==="right"&&(t={...t,direction:S(t.direction,"right")});w({...t})}await new Promise(s=>setTimeout(s,400)),t.x===r.goal.x&&t.y===r.goal.y?(H({particleCount:100,spread:70,origin:{y:.6}}),u("å¤ªæ£’äº†ï¼å°ç†Šæ‰¾åˆ°èœ‚èœœäº†ï¼"),g("success"),h(s=>s+20),setTimeout(()=>{f(s=>s+1)},1500)):(u("å·®ä¸€é»é»ï¼Œå†è©¦è©¦çœ‹ï¼"),g("fail"),setTimeout(()=>{w(r.start),d([]),g(null)},1500)),v(!1)},[i,r,u]),O=()=>{f(0),h(0),C(!1),d([]),g(null)},o=48;return e.jsx(E,{children:e.jsx(G,{title:"ç¨‹å¼æ¢éšªéšŠ",score:x,totalQuestions:5,currentQuestionIndex:n,gameType:"coding",isGameOver:I,onRestart:O,colorClass:"bg-[hsl(var(--macaron-green))] text-[hsl(var(--macaron-green-dark))]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 sm:gap-4 md:gap-6",children:[e.jsxs("h3",{className:"font-display text-base sm:text-lg md:text-xl font-bold text-center px-2",children:["ç¬¬ ",n+1," é—œï¼šå¹«å°ç†Šæ‰¾åˆ°èœ‚èœœï¼"]}),e.jsxs("div",{className:"relative bg-green-100 rounded-xl sm:rounded-2xl p-2 sm:p-3 shadow-inner border-2 sm:border-4 border-green-200",style:{width:r.grid[0].length*o+24,height:r.grid.length*o+24},children:[r.grid.map((t,s)=>t.map((a,y)=>e.jsx("div",{className:`absolute rounded-lg transition-all ${a===0?"bg-green-800/30":"bg-amber-100 border-2 border-amber-200"}`,style:{left:y*o+12,top:s*o+12,width:o-4,height:o-4},children:a===2&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center text-xl sm:text-2xl",children:"ğŸ¯"})},`${y}-${s}`))),p&&e.jsx(m.div,{className:"absolute flex items-center justify-center text-2xl sm:text-3xl",animate:{left:p.x*o+12+(o-4)/2-16,top:p.y*o+12+(o-4)/2-16,rotate:U(p.direction)},transition:{type:"spring",stiffness:200,damping:20},style:{width:32,height:32},children:"ğŸ»"})]}),e.jsx("div",{className:"flex gap-2 sm:gap-3 flex-wrap justify-center",children:Object.keys(j).map(t=>{const s=j[t],a=s.icon;return e.jsxs(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>L(t),disabled:c||i.length>=r.maxCommands,className:`
                    ${s.color} text-white px-3 sm:px-4 py-2 sm:py-3 rounded-xl sm:rounded-2xl font-bold text-sm sm:text-base
                    shadow-lg border-2 border-white/50 disabled:opacity-50 flex items-center gap-1 sm:gap-2
                  `,"data-testid":`cmd-${t}`,children:[e.jsx(a,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden sm:inline",children:s.name})]},t)})}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",children:["æŒ‡ä»¤åˆ— (",i.length,"/",r.maxCommands,")"]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 flex-wrap justify-center min-h-[44px] bg-white/40 rounded-xl px-3 py-2",children:[e.jsx(N,{children:i.map((t,s)=>{const a=j[t],y=a.icon;return e.jsx(m.button,{initial:{scale:0},animate:{scale:1},exit:{scale:0},onClick:()=>P(s),disabled:c,className:`
                        ${a.color} text-white w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl flex items-center justify-center
                        shadow-md border-2 border-white/50 disabled:opacity-50
                      `,title:"é»æ“Šç§»é™¤",children:e.jsx(y,{className:"w-4 h-4 sm:w-5 sm:h-5"})},s)})}),i.length===0&&e.jsx("span",{className:"text-gray-400 text-sm py-1",children:"é»æ“Šä¸Šæ–¹æŒ‰éˆ•æ·»åŠ æŒ‡ä»¤"})]})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsxs(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:M,disabled:c||i.length===0,className:"bg-[hsl(var(--macaron-yellow))] text-[hsl(var(--macaron-yellow-dark))] px-4 sm:px-6 py-2.5 sm:py-3 rounded-full font-bold text-sm sm:text-base shadow-lg disabled:opacity-50 flex items-center gap-2","data-testid":"button-run",children:[e.jsx(D,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"åŸ·è¡Œ"]}),e.jsxs(m.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:$,disabled:c,className:"bg-white/50 px-4 sm:px-6 py-2.5 sm:py-3 rounded-full font-bold text-sm sm:text-base shadow-lg disabled:opacity-50 flex items-center gap-2","data-testid":"button-clear",children:[e.jsx(T,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"æ¸…é™¤"]})]}),e.jsx(N,{children:b&&e.jsx(m.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},className:`
                  px-6 py-3 rounded-full font-bold text-lg
                  ${b==="success"?"bg-green-400 text-white":"bg-red-400 text-white"}
                `,children:b==="success"?"æˆåŠŸï¼ğŸ‰":"å†è©¦ä¸€æ¬¡ï¼ğŸ’ª"})})]})})})}export{Y as default};
