import{c as $,r as u,i as ue,j as o,k as fe,l as me,m as k,P as T,n as B,o as he,d as ge,u as pe,B as V}from"./index-ygY7VRFv.js";import{L as xe}from"./Layout-CtCKEkqP.js";import{G as be}from"./GameShell-BOq1h0bL.js";import{D as ve}from"./download-CF5GKqJU.js";import"./use-scores-BYx9YBm8.js";import"./dialog-5Sutmzol.js";import"./input-DLOEtVGp.js";const we=$("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);const Se=$("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);function G(e,[t,n]){return Math.min(n,Math.max(t,e))}var ye=u.createContext(void 0);function Ce(e){const t=u.useContext(ye);return e||t||"ltr"}function De(e){const t=u.useRef({value:e,previous:e});return u.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var X=["PageUp","PageDown"],W=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Q={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},M="Slider",[z,Re,je]=me(M),[q]=fe(M,[je]),[Ee,I]=q(M),J=u.forwardRef((e,t)=>{const{name:n,min:r=0,max:l=100,step:m=1,orientation:a="horizontal",disabled:f=!1,minStepsBetweenThumbs:h=0,defaultValue:p=[r],value:C,onValueChange:c=()=>{},onValueCommit:g=()=>{},inverted:w=!1,form:y,...b}=e,v=u.useRef(new Set),x=u.useRef(0),i=a==="horizontal"?Pe:ke,[d=[],S]=ue({prop:C,defaultProp:p,onChange:D=>{[...v.current][x.current]?.focus(),c(D)}}),R=u.useRef(d);function A(D){const j=Te(d,D);N(D,j)}function ce(D){N(D,x.current)}function de(){const D=R.current[x.current];d[x.current]!==D&&g(d)}function N(D,j,{commit:F}={commit:!1}){const Y=Ke(m),K=Ve(Math.round((D-r)/m)*m+r,Y),_=G(K,[r,l]);S((P=[])=>{const E=_e(P,_,j);if(Fe(E,h*m)){x.current=E.indexOf(_);const U=String(E)!==String(P);return U&&F&&g(E),U?E:P}else return P})}return o.jsx(Ee,{scope:e.__scopeSlider,name:n,disabled:f,min:r,max:l,valueIndexToChangeRef:x,thumbs:v.current,values:d,orientation:a,form:y,children:o.jsx(z.Provider,{scope:e.__scopeSlider,children:o.jsx(z.Slot,{scope:e.__scopeSlider,children:o.jsx(i,{"aria-disabled":f,"data-disabled":f?"":void 0,...b,ref:t,onPointerDown:k(b.onPointerDown,()=>{f||(R.current=d)}),min:r,max:l,inverted:w,onSlideStart:f?void 0:A,onSlideMove:f?void 0:ce,onSlideEnd:f?void 0:de,onHomeKeyDown:()=>!f&&N(r,0,{commit:!0}),onEndKeyDown:()=>!f&&N(l,d.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:j})=>{if(!f){const K=X.includes(D.key)||D.shiftKey&&W.includes(D.key)?10:1,_=x.current,P=d[_],E=m*K*j;N(P+E,_,{commit:!0})}}})})})})});J.displayName=M;var[Z,ee]=q(M,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Pe=u.forwardRef((e,t)=>{const{min:n,max:r,dir:l,inverted:m,onSlideStart:a,onSlideMove:f,onSlideEnd:h,onStepKeyDown:p,...C}=e,[c,g]=u.useState(null),w=B(t,i=>g(i)),y=u.useRef(void 0),b=Ce(l),v=b==="ltr",x=v&&!m||!v&&m;function s(i){const d=y.current||c.getBoundingClientRect(),S=[0,d.width],A=O(S,x?[n,r]:[r,n]);return y.current=d,A(i-d.left)}return o.jsx(Z,{scope:e.__scopeSlider,startEdge:x?"left":"right",endEdge:x?"right":"left",direction:x?1:-1,size:"width",children:o.jsx(te,{dir:b,"data-orientation":"horizontal",...C,ref:w,style:{...C.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:i=>{const d=s(i.clientX);a?.(d)},onSlideMove:i=>{const d=s(i.clientX);f?.(d)},onSlideEnd:()=>{y.current=void 0,h?.()},onStepKeyDown:i=>{const S=Q[x?"from-left":"from-right"].includes(i.key);p?.({event:i,direction:S?-1:1})}})})}),ke=u.forwardRef((e,t)=>{const{min:n,max:r,inverted:l,onSlideStart:m,onSlideMove:a,onSlideEnd:f,onStepKeyDown:h,...p}=e,C=u.useRef(null),c=B(t,C),g=u.useRef(void 0),w=!l;function y(b){const v=g.current||C.current.getBoundingClientRect(),x=[0,v.height],i=O(x,w?[r,n]:[n,r]);return g.current=v,i(b-v.top)}return o.jsx(Z,{scope:e.__scopeSlider,startEdge:w?"bottom":"top",endEdge:w?"top":"bottom",size:"height",direction:w?1:-1,children:o.jsx(te,{"data-orientation":"vertical",...p,ref:c,style:{...p.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const v=y(b.clientY);m?.(v)},onSlideMove:b=>{const v=y(b.clientY);a?.(v)},onSlideEnd:()=>{g.current=void 0,f?.()},onStepKeyDown:b=>{const x=Q[w?"from-bottom":"from-top"].includes(b.key);h?.({event:b,direction:x?-1:1})}})})}),te=u.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:l,onSlideEnd:m,onHomeKeyDown:a,onEndKeyDown:f,onStepKeyDown:h,...p}=e,C=I(M,n);return o.jsx(T.span,{...p,ref:t,onKeyDown:k(e.onKeyDown,c=>{c.key==="Home"?(a(c),c.preventDefault()):c.key==="End"?(f(c),c.preventDefault()):X.concat(W).includes(c.key)&&(h(c),c.preventDefault())}),onPointerDown:k(e.onPointerDown,c=>{const g=c.target;g.setPointerCapture(c.pointerId),c.preventDefault(),C.thumbs.has(g)?g.focus():r(c)}),onPointerMove:k(e.onPointerMove,c=>{c.target.hasPointerCapture(c.pointerId)&&l(c)}),onPointerUp:k(e.onPointerUp,c=>{const g=c.target;g.hasPointerCapture(c.pointerId)&&(g.releasePointerCapture(c.pointerId),m(c))})})}),ne="SliderTrack",re=u.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,l=I(ne,n);return o.jsx(T.span,{"data-disabled":l.disabled?"":void 0,"data-orientation":l.orientation,...r,ref:t})});re.displayName=ne;var H="SliderRange",oe=u.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,l=I(H,n),m=ee(H,n),a=u.useRef(null),f=B(t,a),h=l.values.length,p=l.values.map(g=>ae(g,l.min,l.max)),C=h>1?Math.min(...p):0,c=100-Math.max(...p);return o.jsx(T.span,{"data-orientation":l.orientation,"data-disabled":l.disabled?"":void 0,...r,ref:f,style:{...e.style,[m.startEdge]:C+"%",[m.endEdge]:c+"%"}})});oe.displayName=H;var L="SliderThumb",se=u.forwardRef((e,t)=>{const n=Re(e.__scopeSlider),[r,l]=u.useState(null),m=B(t,f=>l(f)),a=u.useMemo(()=>r?n().findIndex(f=>f.ref.current===r):-1,[n,r]);return o.jsx(Me,{...e,ref:m,index:a})}),Me=u.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,name:l,...m}=e,a=I(L,n),f=ee(L,n),[h,p]=u.useState(null),C=B(t,s=>p(s)),c=h?a.form||!!h.closest("form"):!0,g=he(h),w=a.values[r],y=w===void 0?0:ae(w,a.min,a.max),b=Be(r,a.values.length),v=g?.[f.size],x=v?Ie(v,y,f.direction):0;return u.useEffect(()=>{if(h)return a.thumbs.add(h),()=>{a.thumbs.delete(h)}},[h,a.thumbs]),o.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[f.startEdge]:`calc(${y}% + ${x}px)`},children:[o.jsx(z.ItemSlot,{scope:e.__scopeSlider,children:o.jsx(T.span,{role:"slider","aria-label":e["aria-label"]||b,"aria-valuemin":a.min,"aria-valuenow":w,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...m,ref:C,style:w===void 0?{display:"none"}:e.style,onFocus:k(e.onFocus,()=>{a.valueIndexToChangeRef.current=r})})}),c&&o.jsx(Ne,{name:l??(a.name?a.name+(a.values.length>1?"[]":""):void 0),form:a.form,value:w},r)]})});se.displayName=L;var Ne=e=>{const{value:t,...n}=e,r=u.useRef(null),l=De(t);return u.useEffect(()=>{const m=r.current,a=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(a,"value").set;if(l!==t&&h){const p=new Event("input",{bubbles:!0});h.call(m,t),m.dispatchEvent(p)}},[l,t]),o.jsx("input",{style:{display:"none"},...n,ref:r,defaultValue:t})};function _e(e=[],t,n){const r=[...e];return r[n]=t,r.sort((l,m)=>l-m)}function ae(e,t,n){const m=100/(n-t)*(e-t);return G(m,[0,100])}function Be(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function Te(e,t){if(e.length===1)return 0;const n=e.map(l=>Math.abs(l-t)),r=Math.min(...n);return n.indexOf(r)}function Ie(e,t,n){const r=e/2,m=O([0,50],[0,r]);return(r-m(t)*n)*n}function Ae(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function Fe(e,t){if(t>0){const n=Ae(e);return Math.min(...n)>=t}return!0}function O(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function Ke(e){return(String(e).split(".")[1]||"").length}function Ve(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var ie=J,ze=re,He=oe,Le=se;const le=u.forwardRef(({className:e,...t},n)=>o.jsxs(ie,{ref:n,className:ge("relative flex w-full touch-none select-none items-center",e),...t,children:[o.jsx(ze,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:o.jsx(He,{className:"absolute h-full bg-primary"})}),o.jsx(Le,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));le.displayName=ie.displayName;function Qe(){const e=u.useRef(null),[t,n]=u.useState(!1),[r,l]=u.useState("#FF6B6B"),[m,a]=u.useState([5]),[f,h]=u.useState("brush"),{playClick:p,playHover:C}=pe(),c=["#FF6B6B","#FFB86C","#FAD790","#A0E7E5","#8BE4F2","#B9BCF2","#F6A0F6","#000000"];u.useEffect(()=>{const s=e.current;if(!s)return;const i=s.getContext("2d");if(!i)return;const d=()=>{const S=s.parentElement;S&&(s.width=S.clientWidth,s.height=S.clientHeight,i.lineCap="round",i.lineJoin="round")};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const g=s=>{const i=e.current;if(!i)return;const d=i.getContext("2d");if(!d)return;n(!0);const{x:S,y:R}=b(s,i);d.beginPath(),d.moveTo(S,R),p()},w=s=>{if(!t)return;const i=e.current;if(!i)return;const d=i.getContext("2d");if(!d)return;const{x:S,y:R}=b(s,i);d.lineWidth=m[0],d.strokeStyle=f==="eraser"?"#FFFFFF":r,d.lineTo(S,R),d.stroke()},y=()=>{n(!1);const s=e.current;if(!s)return;s.getContext("2d")?.beginPath()},b=(s,i)=>{const d=i.getBoundingClientRect();let S,R;return"touches"in s?(S=s.touches[0].clientX,R=s.touches[0].clientY):(S=s.clientX,R=s.clientY),{x:S-d.left,y:R-d.top}},v=()=>{const s=e.current;if(!s)return;const i=s.getContext("2d");i&&(i.clearRect(0,0,s.width,s.height),p())},x=()=>{const s=e.current;if(!s)return;const i=document.createElement("a");i.download="my-masterpiece.png",i.href=s.toDataURL(),i.click(),p()};return o.jsx(xe,{children:o.jsx(be,{title:"創意畫畫板",score:0,totalQuestions:0,currentQuestionIndex:0,gameType:"math",isGameOver:!1,onRestart:()=>{},colorClass:"bg-gradient-to-br from-pink-400 to-purple-500 text-white",children:o.jsxs("div",{className:"flex flex-col gap-4 h-full w-full max-w-5xl mx-auto",children:[o.jsxs("div",{className:"bg-white/95 backdrop-blur-xl p-4 md:p-6 rounded-[2rem] shadow-xl border-4 border-white/50 flex flex-col md:flex-row items-center gap-6 justify-between transform hover:scale-[1.01] transition-transform",children:[o.jsx("div",{className:"flex gap-3 flex-wrap justify-center bg-gray-50/50 p-3 rounded-2xl",children:c.map(s=>o.jsx("button",{className:`
                                        w-10 h-10 md:w-12 md:h-12 rounded-full border-4 transition-all duration-300 transform hover:scale-110
                                        ${r===s&&f==="brush"?"border-gray-800 scale-110 shadow-lg ring-4 ring-white/50":"border-white shadow-md hover:shadow-lg"}
                                    `,style:{backgroundColor:s},onClick:()=>{l(s),h("brush"),p()},"aria-label":`Select color ${s}`},s))}),o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex items-center gap-3 bg-blue-50 px-4 py-2 rounded-full border-2 border-blue-100",children:[o.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-400"}),o.jsx(le,{value:m,onValueChange:a,min:2,max:30,step:1,className:"w-24 md:w-32"}),o.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-400"})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx(V,{variant:f==="eraser"?"default":"outline",size:"icon",onClick:()=>{h("eraser"),p()},className:`
                                        w-14 h-14 rounded-2xl border-b-4 active:border-b-0 active:translate-y-1 transition-all
                                        ${f==="eraser"?"bg-pink-400 hover:bg-pink-500 border-pink-700 text-white":"bg-white border-gray-200 text-gray-400 hover:bg-gray-50"}
                                    `,title:"橡皮擦",children:o.jsx(we,{className:"w-8 h-8"})}),o.jsx(V,{variant:"outline",size:"icon",onClick:v,className:"w-14 h-14 rounded-2xl border-b-4 border-red-200 bg-red-50 text-red-400 hover:bg-red-100 hover:border-red-300 hover:text-red-500 active:border-b-0 active:translate-y-1 transition-all",title:"清除全部",children:o.jsx(Se,{className:"w-8 h-8"})}),o.jsx(V,{variant:"default",size:"icon",onClick:x,className:"w-14 h-14 rounded-2xl border-b-4 border-green-600 bg-green-400 hover:bg-green-500 text-white active:border-b-0 active:translate-y-1 transition-all shadow-lg shadow-green-200",title:"下載作品",children:o.jsx(ve,{className:"w-8 h-8"})})]})]})]}),o.jsxs("div",{className:"flex-1 bg-white p-2 rounded-[2.5rem] shadow-2xl border-8 border-[hsl(var(--macaron-yellow))] relative min-h-[500px]",children:[o.jsx("div",{className:"absolute inset-0 bg-[#fffdf0] rounded-[2rem] overflow-hidden cursor-crosshair m-2 border-2 border-dashed border-gray-200",style:{backgroundImage:"radial-gradient(#ddd 1px, transparent 1px)",backgroundSize:"20px 20px"},children:o.jsx("canvas",{ref:e,onMouseDown:g,onMouseMove:w,onMouseUp:y,onMouseLeave:y,onTouchStart:g,onTouchMove:w,onTouchEnd:y,className:"absolute top-0 left-0 w-full h-full touch-none"})}),o.jsx("div",{className:"absolute -top-4 right-1/4 w-4 h-12 bg-gray-300 rounded-full shadow-md border-2 border-white transform rotate-6"}),o.jsx("div",{className:"absolute -top-4 left-1/4 w-4 h-12 bg-gray-300 rounded-full shadow-md border-2 border-white transform -rotate-3"})]})]})})})}export{Qe as default};
