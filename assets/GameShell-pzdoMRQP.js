import{k as H,l as M,r as s,j as e,L as R,B as y}from"./index-BKJHQ17t.js";import{e as U,D as _,a as q,b as J,c as K,d as Q}from"./confetti.module-DX_nmocB.js";import{a as V}from"./use-scores-BjM8I7zW.js";import{I as W}from"./input-BcmEp2LU.js";import{S as h,A as X,m as d}from"./Layout-BFBCft2f.js";import{A as Y}from"./arrow-left-5wR0mXsk.js";import{G as Z}from"./gift-Dd5BrYTn.js";function re({title:N,score:l,totalQuestions:S,currentQuestionIndex:k,gameType:C,isGameOver:o,onRestart:D,colorClass:A,children:E}){const{profile:r,addCoins:F}=H(),{updateStats:B,checkAchievements:I}=M(),[i,c]=s.useState(r.name),[u,f]=s.useState(0);s.useEffect(()=>{r.name&&c(r.name)},[r.name]);const[p,b]=s.useState(!1),[L,m]=s.useState(!1),[t,x]=s.useState(null),P=V();s.useEffect(()=>{if(o){U({particleCount:150,spread:70,origin:{y:.6},colors:["#FFC0CB","#87CEEB","#98FB98","#DDA0DD","#F0E68C"]});const a=Math.floor(l/10);a>0?(f(a),F(a)):f(0),B(l),setTimeout(()=>{const n=I();n&&x(n),m(!0)},1e3)}},[o]);const[j,g]=s.useState(null),[$,v]=s.useState(!1),z=async()=>{if(i.trim()){b(!0);try{await P.mutateAsync({playerName:i,gameType:C,score:l}),g(l),v(!0),m(!1)}catch(a){console.error(a)}finally{b(!1)}}},G=()=>{g(null),v(!1),x(null),c(""),D()},w=()=>{m(!1),x(null)},T="/kids/".replace(/\/$/,"");return e.jsxs("div",{className:`min-h-[80vh] flex flex-col ${A} rounded-[2rem] md:rounded-[3rem] p-4 md:p-8 shadow-xl relative overflow-hidden border-4 md:border-8 border-white`,children:[e.jsx("div",{className:"absolute top-0 right-0 p-12 opacity-10 pointer-events-none",children:e.jsx(h,{className:"w-64 h-64 fill-current"})}),e.jsxs("div",{className:"flex justify-between items-center mb-6 md:mb-8 relative z-10",children:[e.jsx(R,{href:T+"/",children:e.jsx("button",{className:"bg-white/40 hover:bg-white/60 p-2 md:p-3 rounded-xl md:rounded-2xl transition-all hover:scale-105 active:scale-95 text-inherit","data-testid":"button-back",children:e.jsx(Y,{className:"w-6 h-6 md:w-8 md:h-8 stroke-[3]"})})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"font-display text-xl md:text-3xl font-bold text-shadow",children:N}),e.jsx("div",{className:"flex gap-1 mt-1",children:Array.from({length:S}).map((a,n)=>e.jsx("div",{className:`w-2 h-2 md:w-3 md:h-3 rounded-full transition-colors duration-300 ${n<k?"bg-white":"bg-black/10"}`},n))})]}),e.jsxs("div",{className:"bg-white/40 px-4 md:px-6 py-2 rounded-xl md:rounded-2xl font-display font-bold text-xl md:text-2xl flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 md:w-6 md:h-6 fill-yellow-400 text-yellow-500"}),l]})]}),e.jsx("div",{className:"flex-1 flex flex-col justify-center relative z-10",children:e.jsx(X,{mode:"wait",children:o?e.jsxs(d.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center flex flex-col items-center gap-6 py-10",children:[e.jsx("h1",{className:"font-display text-5xl md:text-6xl font-black text-white text-shadow-lg",children:"å¤ªæ£’äº†ï¼"}),e.jsxs("div",{className:"bg-white/30 backdrop-blur-md p-6 md:p-8 rounded-3xl w-full max-w-md",children:[e.jsx("p",{className:"text-xl md:text-2xl font-bold mb-2",children:"æœ€çµ‚å¾—åˆ†"}),e.jsx("div",{className:"text-6xl md:text-8xl font-black text-white text-shadow-lg mb-4",children:j!==null?j:l}),t&&e.jsxs(d.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",delay:.3},className:"bg-white/50 p-4 rounded-2xl mb-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-5 h-5"}),e.jsx("span",{className:"font-bold",children:"ç²å¾—è²¼ç´™ï¼"})]}),e.jsx("div",{className:"text-6xl",children:t.emoji}),e.jsx("div",{className:"text-sm font-medium mt-1",children:t.name})]}),u>0&&e.jsxs(d.div,{initial:{scale:0,y:20},animate:{scale:1,y:0},transition:{delay:.2},className:"flex items-center gap-2 bg-yellow-400 text-yellow-900 px-6 py-2 rounded-full font-black text-xl mb-4 shadow-lg border-2 border-white",children:[e.jsx(h,{className:"w-6 h-6 fill-white text-white"}),e.jsxs("span",{children:["+",u," é‡‘å¹£"]})]}),$&&e.jsx("div",{className:"bg-green-100 text-green-700 px-4 py-2 rounded-xl mb-4 font-bold",children:"åˆ†æ•¸å·²å„²å­˜ï¼"}),e.jsx("button",{onClick:G,className:"w-full bg-white text-current font-bold py-3 md:py-4 rounded-2xl text-lg md:text-xl shadow-lg hover:scale-105 transition-transform","data-testid":"button-play-again",children:"å†ç©ä¸€æ¬¡"})]})]}):E})}),e.jsx(_,{open:L,onOpenChange:w,children:e.jsxs(q,{className:"sm:max-w-md border-4 border-[hsl(var(--macaron-purple))] rounded-3xl bg-white/95 backdrop-blur-xl",children:[e.jsx(J,{children:e.jsx(K,{className:"font-display text-3xl text-center text-[hsl(var(--macaron-purple-dark))]",children:t?"æ­å–œä½ ï¼":"æ–°ç´€éŒ„ï¼"})}),e.jsxs("div",{className:"flex flex-col gap-4 py-4",children:[e.jsxs("div",{className:"text-center text-lg text-muted-foreground",children:["ä½ å¾—äº† ",e.jsx("span",{className:"font-bold text-[hsl(var(--macaron-purple))] text-2xl",children:l})," åˆ†ï¼"]}),t&&e.jsxs(d.div,{initial:{scale:0},animate:{scale:1},className:"text-center bg-gradient-to-br from-yellow-100 to-pink-100 p-4 rounded-2xl",children:[e.jsx("div",{className:"text-5xl mb-2",children:t.emoji}),e.jsxs("div",{className:"font-bold",children:["ç²å¾—ã€Œ",t.name,"ã€è²¼ç´™ï¼"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.rarity==="å‚³èªª"&&"âœ¨ å‚³èªªç´šè²¼ç´™ï¼",t.rarity==="ç¨€æœ‰"&&"ğŸ’ ç¨€æœ‰è²¼ç´™ï¼"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-bold ml-1",children:"ä½ çš„åå­—"}),e.jsx(W,{value:i,onChange:a=>c(a.target.value),placeholder:"è¼¸å…¥ä½ çš„åå­—...",className:"text-lg py-6 rounded-xl border-2 border-gray-200 focus-visible:ring-[hsl(var(--macaron-purple))]",autoFocus:!0,"data-testid":"input-player-name"})]})]}),e.jsxs(Q,{className:"sm:justify-center gap-2",children:[e.jsx(y,{variant:"outline",onClick:w,className:"flex-1 rounded-xl",children:"ç¨å¾Œå†èªª"}),e.jsx(y,{onClick:z,disabled:!i.trim()||p,className:"flex-1 btn-macaron btn-purple text-lg py-6 rounded-xl","data-testid":"button-save-score",children:p?"å„²å­˜ä¸­...":"å„²å­˜åˆ†æ•¸"})]})]})})]})}export{re as G};
