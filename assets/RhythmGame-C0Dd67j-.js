import{r as a,j as e,B as M}from"./index-dxj7E4H-.js";import{L as B,A as I,m as S}from"./Layout-CmlOHSNV.js";import{G as P}from"./GameShell-CODfseyM.js";import{M as O}from"./music-BCebsaw7.js";import"./confetti.module-BS7HiWFO.js";import"./use-scores-D77kwo0O.js";import"./input-R0n0rv70.js";const _={C3:130.81,D3:146.83,E3:164.81,F3:174.61,G3:196,A3:220,B3:246.94,C4:261.63,D4:293.66,E4:329.63,F4:349.23,G4:392,A4:440,B4:493.88,C5:523.25,D5:587.33,E5:659.25,F5:698.46,G5:783.99,A5:880,B5:987.77},A=[{id:"star",title:"小星星",bpm:100,melody:[{note:"C4",duration:1},{note:"C4",duration:1},{note:"G4",duration:1},{note:"G4",duration:1},{note:"A4",duration:1},{note:"A4",duration:1},{note:"G4",duration:2},{note:"F4",duration:1},{note:"F4",duration:1},{note:"E4",duration:1},{note:"E4",duration:1},{note:"D4",duration:1},{note:"D4",duration:1},{note:"C4",duration:2}]},{id:"tigers",title:"兩隻老虎",bpm:120,melody:[{note:"C4",duration:1},{note:"D4",duration:1},{note:"E4",duration:1},{note:"C4",duration:1},{note:"C4",duration:1},{note:"D4",duration:1},{note:"E4",duration:1},{note:"C4",duration:1},{note:"E4",duration:1},{note:"F4",duration:1},{note:"G4",duration:2},{note:"E4",duration:1},{note:"F4",duration:1},{note:"G4",duration:2}]}];class q{constructor(){this.ctx=null,typeof window<"u"&&(this.ctx=new(window.AudioContext||window.webkitAudioContext))}playTone(d,f,c){if(!this.ctx)return;const u=this.ctx.createOscillator(),i=this.ctx.createGain();u.type="sine",u.frequency.value=_[d]||440,u.connect(i),i.connect(this.ctx.destination),i.gain.setValueAtTime(0,c),i.gain.linearRampToValueAtTime(.3,c+.05),i.gain.exponentialRampToValueAtTime(.01,c+f-.05),u.start(c),u.stop(c+f)}resume(){this.ctx?.resume()}}function J(){const[m,d]=a.useState(!1),[f,c]=a.useState(0),[u,i]=a.useState(0),[N,k]=a.useState(A[0]),[F,y]=a.useState([]),[g,v]=a.useState(null),s=a.useRef(null),h=a.useRef(0),T=a.useRef(0);a.useEffect(()=>(s.current=new q,()=>cancelAnimationFrame(T.current)),[]);const R=t=>{if(!s.current)return;s.current.resume(),d(!0),c(0),i(0),k(t);const r=60/t.bpm;let l=0;const o=t.melody.map((n,b)=>{const x=l;return l+=n.duration*r,{...n,time:x,id:b,hit:!1,missed:!1}});y(o),h.current=s.current.ctx.currentTime+2,o.forEach(n=>{s.current?.playTone(n.note,n.duration*r,h.current+n.time)}),E()},E=()=>{if(!s.current)return;const r=s.current.ctx.currentTime-h.current;y(l=>l.map(o=>!o.hit&&!o.missed&&r>o.time+.5?(i(0),{...o,missed:!0}):o)),r<N.melody.length*(60/N.bpm)*2?T.current=requestAnimationFrame(E):d(!1)},G=()=>{if(!m||!s.current)return;const r=s.current.ctx.currentTime-h.current;y(l=>{const o=l.findIndex(n=>!n.hit&&!n.missed&&Math.abs(r-n.time)<.3);if(o!==-1){const n=l[o],b=Math.abs(r-n.time);let x=0,p="",w="";b<.1?(x=100,p="Perfect!!",w="text-yellow-500 text-4xl"):b<.2?(x=50,p="Great!",w="text-green-500 text-3xl"):(x=20,p="Good",w="text-blue-500 text-2xl"),c(j=>j+x),i(j=>j+1),D(p,w);const C=[...l];return C[o]={...n,hit:!0},C}return l})},D=(t,r)=>{v({text:t,type:r}),setTimeout(()=>v(null),500)};return e.jsx(B,{children:e.jsx(P,{title:"節奏達人",score:f,totalQuestions:0,currentQuestionIndex:0,gameType:"melody",isGameOver:!1,onRestart:()=>d(!1),colorClass:"bg-gradient-to-br from-indigo-500 to-purple-600 text-white",children:e.jsxs("div",{className:"relative w-full h-[60vh] flex flex-col items-center overflow-hidden",children:[!m&&e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-white/10 backdrop-blur-md rounded-3xl",children:[e.jsx(O,{className:"w-20 h-20 text-white mb-4 animate-bounce"}),e.jsx("h2",{className:"text-3xl font-black mb-6 text-white text-shadow",children:"選擇一首歌"}),e.jsx("div",{className:"flex gap-4",children:A.map(t=>e.jsx(M,{onClick:()=>R(t),className:"bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold text-xl py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-all",children:t.title},t.id))})]}),e.jsxs("div",{className:"flex-1 w-full max-w-md bg-black/20 relative rounded-3xl border-4 border-white/20 my-4 overflow-hidden",children:[e.jsx("div",{className:"absolute bottom-20 left-0 right-0 h-1 bg-white/30"}),e.jsx("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 w-24 h-24 border-4 border-white rounded-full -mb-12 flex items-center justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-white/10 rounded-full animate-pulse"})}),m&&F.map(t=>t.hit?null:e.jsx(z,{delay:t.time,duration:2,onMiss:()=>{}},t.id)),e.jsx(I,{children:g&&e.jsx(S.div,{initial:{scale:.5,opacity:0},animate:{scale:1.5,opacity:1},exit:{scale:2,opacity:0},className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 font-black ${g.type} text-shadow-lg z-30`,children:g.text})}),u>1&&e.jsxs("div",{className:"absolute top-10 right-10 text-right",children:[e.jsx("div",{className:"text-4xl font-black text-yellow-400 italic font-display",children:u}),e.jsx("div",{className:"text-sm font-bold text-white uppercase",children:"Combo!"})]})]}),e.jsx("button",{className:"w-full max-w-md h-32 mb-4 bg-gradient-to-t from-orange-400 to-orange-300 rounded-3xl shadow-[0_10px_0_rgb(200,100,0)] active:shadow-none active:translate-y-2 transition-all flex items-center justify-center",onMouseDown:G,onTouchStart:t=>{t.preventDefault(),G()},children:e.jsx("span",{className:"text-3xl font-black text-white text-shadow",children:"TAP!"})})]})})})}function z({delay:m,duration:d}){return e.jsx(S.div,{initial:{y:-50,opacity:1},animate:{y:500,opacity:1},transition:{duration:d,delay:m,ease:"linear"},className:"absolute top-0 left-1/2 -translate-x-1/2 w-16 h-16 bg-pink-400 rounded-full border-4 border-white shadow-lg z-10 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-pink-200"})})}export{J as default};
