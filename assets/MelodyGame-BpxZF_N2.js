import{r as s,j as o}from"./index-CD2wNbFC.js";import{L as G,m as j}from"./Layout-DFM5YMEB.js";import{G as O,c as P}from"./GameShell-BDxTv0Re.js";import{u as A}from"./use-tts-DqP_SXTa.js";import"./use-scores-CDq8lC3W.js";import"./dialog-Vj9oaDWx.js";import"./input-CR4HPgh5.js";const w=[{id:"do",name:"Do",frequency:261.63,animal:"üê±",color:"hsl(var(--macaron-pink))"},{id:"re",name:"Re",frequency:293.66,animal:"üê∂",color:"hsl(var(--macaron-blue))"},{id:"mi",name:"Mi",frequency:329.63,animal:"üê•",color:"hsl(var(--macaron-yellow))"},{id:"fa",name:"Fa",frequency:349.23,animal:"üê∞",color:"hsl(var(--macaron-green))"},{id:"sol",name:"Sol",frequency:392,animal:"üêª",color:"hsl(var(--macaron-purple))"}],b=[{name:"Â∞èÊòüÊòüÈñãÈ†≠",notes:["do","do","sol","sol"]},{name:"Á∞°ÂñÆ‰∏äÂçá",notes:["do","re","mi"]},{name:"Á∞°ÂñÆ‰∏ãÈôç",notes:["mi","re","do"]},{name:"Ë∑≥Ë∫ç",notes:["do","mi","sol"]},{name:"‰æÜÂõû",notes:["do","re","do"]}];function C(c,m=.3){const a=new(window.AudioContext||window.webkitAudioContext),n=a.createOscillator(),t=a.createGain();n.connect(t),t.connect(a.destination),n.frequency.value=c,n.type="sine",t.gain.setValueAtTime(.3,a.currentTime),t.gain.exponentialRampToValueAtTime(.01,a.currentTime+m),n.start(a.currentTime),n.stop(a.currentTime+m)}function $(){const[c,m]=s.useState(0),[a,n]=s.useState(0),[t,q]=s.useState(b[0]),[g,p]=s.useState([]),[i,T]=s.useState(!1),[S,x]=s.useState(null),[y,v]=s.useState(!1),[k,h]=s.useState(null),{speak:d}=A(),N=s.useCallback(async()=>{T(!0),d("‰ªîÁ¥∞ËÅΩÂñîÔºÅ");for(let e=0;e<t.notes.length;e++){const l=t.notes[e],f=w.find(r=>r.id===l);x(l),C(f.frequency,.4),await new Promise(r=>setTimeout(r,600)),x(null),await new Promise(r=>setTimeout(r,200))}T(!1),d("Êèõ‰Ω†‰∫ÜÔºÅ")},[t,d]),E=()=>{if(c>=10){v(!0);return}const e=b[Math.floor(Math.random()*b.length)];q(e),p([]),h(null)};s.useEffect(()=>{E()},[c]),s.useEffect(()=>{if(t&&!y){const e=setTimeout(()=>N(),500);return()=>clearTimeout(e)}},[t,y]);const M=e=>{if(i)return;const l=w.find(u=>u.id===e);C(l.frequency),x(e),setTimeout(()=>x(null),200);const f=[...g,e];p(f);const r=t.notes[g.length];if(e!==r){d("ÂÜçË©¶Ë©¶ÁúãÔºÅ"),h("wrong"),setTimeout(()=>{p([]),h(null)},1e3);return}f.length===t.notes.length&&(P({particleCount:40,spread:60,colors:["#FFC0CB","#87CEEB","#98FB98"]}),d("Â§™Ê£í‰∫ÜÔºÅ"),h("correct"),n(u=>u+10),setTimeout(()=>m(u=>u+1),1e3))},R=()=>{m(0),n(0),v(!1),p([])};return o.jsx(G,{children:o.jsx(O,{title:"DoReMi Èü≥Ê®ÇÊúÉ",score:a,totalQuestions:10,currentQuestionIndex:c,gameType:"melody",isGameOver:y,onRestart:R,colorClass:"bg-[hsl(var(--macaron-purple))] text-[hsl(var(--macaron-purple-dark))]",children:o.jsxs("div",{className:"flex flex-col items-center gap-4 sm:gap-6",children:[o.jsx("h3",{className:"font-display text-lg sm:text-xl md:text-2xl font-bold text-center px-2",children:i?"‰ªîÁ¥∞ËÅΩÊóãÂæã...":"Ë∑üËëóÂΩàÂ•è‰∏ÄÊ®£ÁöÑÊóãÂæãÔºÅ"}),o.jsx("div",{className:"flex gap-1.5 sm:gap-2 mb-2 sm:mb-4",children:t.notes.map((e,l)=>o.jsx("div",{className:`w-3 h-3 sm:w-4 sm:h-4 rounded-full transition-all ${l<g.length?k==="wrong"?"bg-red-400":"bg-white":"bg-white/30"}`},l))}),o.jsx("div",{className:"flex gap-2 sm:gap-3 flex-wrap justify-center px-2",children:w.map(e=>o.jsxs(j.button,{whileHover:{scale:1.05},whileTap:{scale:.95},animate:{scale:S===e.id?1.2:1,boxShadow:S===e.id?"0 0 30px rgba(255,255,255,0.8)":"none"},onClick:()=>M(e.id),disabled:i,className:`
                  w-14 h-16 sm:w-18 sm:h-22 md:w-24 md:h-28 rounded-xl sm:rounded-2xl flex flex-col items-center justify-center gap-0.5 sm:gap-1
                  shadow-lg border-2 sm:border-4 border-white transition-all
                  ${i?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                `,style:{backgroundColor:e.color},"data-testid":`note-${e.id}`,children:[o.jsx("span",{className:"text-2xl sm:text-3xl md:text-5xl",children:e.animal}),o.jsx("span",{className:"font-display font-bold text-xs sm:text-sm text-white/80",children:e.name})]},e.id))}),o.jsx(j.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:N,disabled:i,className:"mt-2 sm:mt-4 bg-white/40 px-4 sm:px-6 py-2.5 sm:py-3 rounded-full font-bold text-base sm:text-lg disabled:opacity-50","data-testid":"button-replay",children:i?"Êí≠Êîæ‰∏≠...":"ÂÜçËÅΩ‰∏ÄÊ¨°"})]})})})}export{$ as default};
